# Интеллектуальный поиск по PDF-документам

**Курсовой проект** — веб‑приложение на Go, Python и PostgreSQL для загрузки и умного поиска по файлам.  
Поддерживает два режима: классический полнотекстовый (с учётом опечаток) и семантический на основе нейросетевых эмбеддингов.

---

## Возможности

- Загрузка PDF (до 50 МБ) с метаданными (название, авторы, год, категория).
- Фоновая обработка: извлечение текста, разбивка на чанки, генерация эмбеддингов.
- **Полнотекстовый поиск** по содержимому с нечётким сравнением (триграммы).
- **Семантический поиск** — находит фрагменты по смыслу, даже если нет точных ключевых слов.
- Веб‑интерфейс на Flask + htmx: асинхронный поиск при вводе, просмотр PDF во встроенном просмотрщике (PDF.js).
- Полностью контейнеризировано (Docker Compose) — лёгкий запуск одной командой.

---

## Архитектура

```
┌──────────┐     ┌────────────┐     ┌──────────┐
│ Браузер  │ <-> │  Flask     │ <-> │ Go-API   │ <-> ┌─────────┐
│ (htmx)   │     │  (Web UI)  │     │ (бекенд) │     │ Postgres│
└──────────┘     └────────────┘     └────┬─────┘     │+pgvector│
                                         │           └─────────┘
                                         ▼
                                   ┌─────────────┐
                                   │  Python     │
                                   │  embedder   │
                                   │ (эмбеддинги)│
                                   └─────────────┘
```

- **Go‑сервер** — ядро: загрузка файлов, работа с БД, координация фоновых задач.
- **Python‑микросервис** — генерация эмбеддингов через `sentence-transformers/all-MiniLM-L6-v2`.
- **PostgreSQL + pgvector** — хранение документов, чанков и векторных индексов.
- **Flask‑интерфейс** — отдельный сервис для веба, общается с Go по HTTP.

---

## Технологический стек

| Компонент       | Технологии                                                                 |
|-----------------|----------------------------------------------------------------------------|
| Бекенд (Go)     | Go 1.21+, `chi`, `pgx`, `pgvector-go`, `ledongthuc/pdf`, `golang-migrate` |
| Эмбеддинги      | Python 3.10+, FastAPI, `sentence-transformers`                     |
| База данных     | PostgreSQL 15+, расширения `pg_trgm` и `vector`                           |
| Веб‑интерфейс   | Flask, Jinja2, htmx, PDF.js                                               |
| Инфраструктура  | Docker, Docker Compose                                                     |

---

## Быстрый старт

### Предварительные требования

- Установленные [Docker](https://docs.docker.com/get-docker/) и [Docker Compose](https://docs.docker.com/compose/install/)
- (Опционально) `make` для удобства

### Запуск

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourname/pdf-search.git
   cd pdf-search
   ```

2. Создайте файл `.env` из шаблона:
   ```bash
   cp .env.example .env
   ```

3. Запустите все сервисы:
   ```bash
   docker-compose up --build
   ```

4. Откройте браузер и перейдите по адресу [http://localhost:5005](http://localhost:5005)

Готово! Можно загружать PDF и искать.

> При первом запуске Python‑сервис скачает модель `all-MiniLM-L6-v2` (около 90 МБ). Это может занять несколько минут.

---

## Использование

### Загрузка документа

- Нажмите **«Загрузить новый PDF»**.
- Заполните обязательное поле «Название», опционально — авторов, год, категорию.
- Выберите PDF‑файл и нажмите «Загрузить».
- Документ появится в результатах поиска после окончания обработки (извлечение текста и эмбеддингов).

### Поиск

- На главной странице введите запрос в строку поиска.
- Переключайтесь между **«Полнотекстовый»** и **«Семантический»** режимами.
- Результаты (фрагменты текста) появляются по мере ввода с задержкой 500 мс.
- Нажмите на заголовок, чтобы открыть полный документ и просмотреть его через PDF.js.

---

## API (основные эндпоинты Go‑сервера)

| Метод    | Путь                 | Описание                                  |
|----------|----------------------|-------------------------------------------|
| POST     | `/upload`            | Загрузить PDF (multipart/form-data)       |
| GET      | `/search?q=...&type=text/vector&limit=...` | Поиск (результаты в JSON) |
| GET      | `/documents`         | Получить список документов                |
| GET      | `/documents/{id}`    | Получить метаданные документа             |
| DELETE   | `/documents/{id}`    | Удалить документ                          |

---

## Переменные окружения

### Go‑сервер (`api`)
- `DATABASE_URL` — строка подключения к PostgreSQL.
- `EMBEDDER_URL` — адрес Python‑сервиса (по умолч. `http://embedder:5001`).
- `UPLOAD_DIR` — директория для сохранения PDF (по умолч. `uploads`).
- `PORT` — порт (по умолч. `8080`).
- `ENV` — `development` или `production` (влияет на формат логов).

### Flask‑интерфейс (`webui`)
- `GO_API_BASE_URL` — базовый URL Go‑сервера (по умолч. `http://api:8080`).
- `UPLOAD_DIR` — директория для сохранения PDF (по умолч. `uploads`).

### Python‑сервис (`embedder`)
- `MODEL_NAME` — модель sentence‑transformers (по умолч. `all-MiniLM-L6-v2`).
- `MAX_TEXT_LENGTH` — обрезка текста перед отправкой в модель (по умолч. `5000`).

### PostgreSQL (`postgres`)
- `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB` — учётные данные.

---

## Разработка без Docker

### Go‑сервер

1. Установите PostgreSQL и создайте базу с расширениями `pg_trgm` и `vector`.
2. Скопируйте `.env.example` в `.env` и отредактируйте.
3. Запустите миграции:
   ```bash
   go run cmd/api/main.go
   ```
4. Запустите сервер:
   ```bash
   go run cmd/api/main.go
   ```

### Python‑сервис

```bash
cd embedder
pip install -r requirements.txt
python app.py
```

### Flask‑интерфейс

```bash
cd webui
pip install -r requirements.txt
flask run
```

Не забудьте настроить переменные окружения и запустить необходимые зависимости.

---

## Структура проекта

```
.
├── server/                  # Go-сервер
├── embedder/                # Python-сервис эмбеддингов
├── webui/                   # Flask-интерфейс
├── uploads/                 # загруженные PDF (том Docker)
├── docker-compose.yml
├── .env.example
└── README.md
```

---

## Лицензия

Проект создан в образовательных целях. Используйте свободно.

---

**Автор:** Бондарь Андрей
**Курсовая работа,** РТУ МИРЭА, 2026

